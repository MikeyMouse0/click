<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>WikiSearch — Поиск статей</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <style>
    :root {
      --primary-color: #3b82f6;
      --bg-color: #f3f4f6;
      --text-color: #111827;
      --card-bg: #ffffff;
      --header-bg: #ffffff;
      --input-bg: #ffffff;
      --modal-bg: #ffffff;
    }

    .dark {
      --primary-color: #60a5fa;
      --bg-color: #111827;
      --text-color: #f3f4f6;
      --card-bg: #1f2937;
      --header-bg: #1f2937;
      --input-bg: #374151;
      --modal-bg: #1f2937;
    }

    .nature {
      --primary-color: #10b981;
      --bg-color: #ecfdf5;
      --text-color: #064e3b;
      --card-bg: #d1fae5;
      --header-bg: #a7f3d0;
      --input-bg: #d1fae5;
      --modal-bg: #d1fae5;
    }

    .ocean {
      --primary-color: #06b6d4;
      --bg-color: #ecfeff;
      --text-color: #164e63;
      --card-bg: #cffafe;
      --header-bg: #a5f3fc;
      --input-bg: #cffafe;
      --modal-bg: #cffafe;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: var(--bg-color);
      color: var(--text-color);
    }

    .fade-in {
      animation: fadeIn 0.4s ease-in-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .modal {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0,0,0,0.6);
      display: none;
      justify-content: center;
      align-items: flex-start;
      z-index: 50;
      padding: 20px;
      overflow-y: auto;
    }

    .modal.active {
      display: flex;
    }

    .modal-content {
      background: var(--modal-bg);
      padding: 20px;
      border-radius: 12px;
      max-height: 90vh;
      overflow-y: auto;
      width: 100%;
      max-width: 900px;
      position: relative;
      margin: 20px 0;
      color: var(--text-color);
    }

    .close-btn {
      position: absolute;
      top: 10px;
      right: 10px;
      cursor: pointer;
      font-size: 1.5rem;
      color: #777;
      z-index: 10;
    }

    .back-btn, .download-btn {
      margin-bottom: 10px;
      font-weight: bold;
      cursor: pointer;
      padding: 6px 12px;
      border-radius: 6px;
      transition: all 0.3s ease;
    }

    .back-btn {
      color: var(--primary-color);
      background: transparent;
      border: none;
      font-size: 1rem;
    }

    .download-btn {
      background-color: var(--primary-color);
      color: white;
      border: none;
      font-weight: bold;
    }

    .download-btn:hover {
      opacity: 0.9;
    }

    .settings-icon {
      cursor: pointer;
      transition: transform 0.3s;
    }

    .settings-icon:hover {
      transform: rotate(90deg);
    }

    .settings-panel {
      position: fixed;
      top: 70px;
      right: 20px;
      background: var(--card-bg);
      border: 1px solid #ccc;
      border-radius: 8px;
      padding: 15px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      z-index: 60;
      display: none;
      min-width: 250px;
    }

    .settings-panel label {
      display: block;
      margin-bottom: 10px;
    }

    .settings-panel h3 {
      font-weight: bold;
      margin-bottom: 10px;
      border-bottom: 1px solid #eee;
      padding-bottom: 5px;
    }

    .wiki-frame {
      width: 100%;
      height: 600px;
      border: none;
      margin-top: 10px;
      border-radius: 8px;
    }

    .wiki-frame.small {
      height: 400px;
    }

    .wiki-frame.medium {
      height: 600px;
    }

    .wiki-frame.large {
      height: 800px;
    }

    .wiki-frame.full {
      height: calc(100vh - 100px);
    }

    .card {
      background: var(--card-bg);
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      transition: box-shadow 0.3s;
      overflow: hidden;
      cursor: pointer;
    }

    .card:hover {
      box-shadow: 0 4px 10px rgba(0,0,0,0.15);
    }

    .thumbnail {
      width: 100%;
      height: auto;
      object-fit: cover;
      max-height: 200px;
    }

    .card-body {
      padding: 15px;
    }

    .card-title {
      font-weight: bold;
      font-size: 1.1rem;
      color: var(--primary-color);
      margin-bottom: 10px;
    }

    .card-excerpt {
      font-size: 0.9rem;
      color: var(--text-color);
      opacity: 0.9;
    }

    .hero {
      text-align: center;
      padding: 20px 0;
      animation: fadeIn 1s ease-in-out;
    }

    .hero h2 {
      font-size: 2rem;
      font-weight: bold;
      color: var(--text-color);
    }

    .hero p {
      font-size: 1.1rem;
      color: var(--text-color);
      opacity: 0.8;
      margin: 10px 0 20px;
    }

    .search-example {
      display: inline-block;
      padding: 4px 12px;
      background: rgba(0,0,0,0.1);
      border-radius: 6px;
      font-style: italic;
      animation: blink 2s infinite;
    }

    @keyframes blink {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.4; }
    }

    /* Стили для флагов */
    .flag-icon {
      width: 24px;
      height: 16px;
      margin-right: 8px;
      vertical-align: middle;
      object-fit: cover;
      border: 1px solid #e2e8f0;
    }

    .language-option img {
      width: 24px;
      height: 16px;
      margin-right: 8px;
      object-fit: cover;
    }

    .language-selector {
      position: relative;
      display: inline-block;
      margin-left: 10px;
    }

    .language-btn {
      background: none;
      border: none;
      cursor: pointer;
      padding: 5px;
    }

    .language-dropdown {
      display: none;
      position: absolute;
      right: 0;
      background-color: var(--card-bg);
      min-width: 160px;
      box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
      z-index: 70;
      border-radius: 8px;
      padding: 10px;
    }

    .language-dropdown.show {
      display: block;
    }

    .language-option {
      padding: 8px 12px;
      cursor: pointer;
      display: flex;
      align-items: center;
    }

    .language-option:hover {
      background-color: rgba(0,0,0,0.1);
    }

    /* Стили для переключателя тем */
    .theme-option {
      padding: 8px 12px;
      cursor: pointer;
      display: flex;
      align-items: center;
      border-radius: 6px;
      margin-bottom: 5px;
    }

    .theme-option:hover {
      background-color: rgba(0,0,0,0.1);
    }

    .theme-option.active {
      background-color: var(--primary-color);
      color: white;
    }

    /* Мобильные стили */
    @media (max-width: 768px) {
      header .container {
        flex-direction: column;
        padding: 10px;
      }
      
      #search-form {
        width: 100%;
        margin: 10px 0;
      }
      
      .hero h2 {
        font-size: 1.5rem;
      }
      
      .hero p {
        font-size: 1rem;
      }
      
      .modal-content {
        padding: 15px;
        margin: 10px;
      }
      
      .wiki-frame {
        height: 400px;
      }
      
      .wiki-frame.small {
        height: 300px;
      }
      
      .wiki-frame.medium {
        height: 400px;
      }
      
      .wiki-frame.large {
        height: 500px;
      }
      
      .language-selector {
        margin: 10px 0;
      }
      
      .settings-panel {
        top: 100px;
        right: 10px;
        left: 10px;
        max-width: calc(100% - 20px);
      }
    }
  </style>
</head>
<body>

  <!-- Header -->
  <header class="shadow-md sticky top-0 z-10" style="background-color: var(--header-bg);">
    <div class="container mx-auto px-4 py-4 flex flex-col md:flex-row justify-between items-center">
      <h1 class="text-2xl font-bold mb-2 md:mb-0" style="color: var(--primary-color);">WikiSearch</h1>

      <form id="search-form" class="relative w-full max-w-lg mx-0 md:mx-4">
        <input 
          type="text" 
          id="search-input" 
          placeholder="Поиск статей..." 
          class="w-full p-3 pl-10 border rounded-lg focus:outline-none focus:ring-2"
          style="background-color: var(--input-bg); color: var(--text-color); border-color: var(--primary-color);"
        />
        <svg class="absolute left-3 top-3.5 w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" style="color: var(--primary-color);">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
        </svg>
      </form>

      <div class="flex items-center mt-2 md:mt-0">
        <!-- Кнопка выбора языка -->
        <div class="language-selector">
          <button class="language-btn" onclick="toggleLanguageDropdown()">
            <img id="current-language-flag" src="https://flagcdn.com/ru.svg" class="flag-icon" alt="Язык">
          </button>
          <div id="language-dropdown" class="language-dropdown">
            <div class="language-option" onclick="changeLanguage('ru', 'Русский')">
              <img src="https://flagcdn.com/ru.svg" class="flag-icon" alt="Русский"> Русский
            </div>
            <div class="language-option" onclick="changeLanguage('en', 'English')">
              <img src="https://flagcdn.com/gb.svg" class="flag-icon" alt="English"> English
            </div>
            <div class="language-option" onclick="changeLanguage('uk', 'Українська')">
              <img src="https://flagcdn.com/ua.svg" class="flag-icon" alt="Українська"> Українська
            </div>
            <div class="language-option" onclick="changeLanguage('ja', '日本語')">
              <img src="https://flagcdn.com/jp.svg" class="flag-icon" alt="日本語"> 日本語
            </div>
            <div class="language-option" onclick="changeLanguage('de', 'Deutsch')">
              <img src="https://flagcdn.com/de.svg" class="flag-icon" alt="Deutsch"> Deutsch
            </div>
            <div class="language-option" onclick="changeLanguage('fr', 'Français')">
              <img src="https://flagcdn.com/fr.svg" class="flag-icon" alt="Français"> Français
            </div>
            <div class="language-option" onclick="changeLanguage('es', 'Español')">
              <img src="https://flagcdn.com/es.svg" class="flag-icon" alt="Español"> Español
            </div>
            <div class="language-option" onclick="changeLanguage('zh', '中文')">
              <img src="https://flagcdn.com/cn.svg" class="flag-icon" alt="中文"> 中文
            </div>
          </div>
        </div>

        <!-- Кнопка настроек -->
        <div class="relative ml-2">
          <svg onclick="toggleSettings()" class="settings-icon w-6 h-6 cursor-pointer" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" style="color: var(--primary-color);">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
          </svg>

          <!-- Панель настроек -->
          <div id="settings-panel" class="settings-panel">
            <h3 id="settings-title">Настройки</h3>
            
            <h3 id="view-mode-title">Режим просмотра</h3>
            <label>
              <input type="radio" name="viewMode" value="default" checked onchange="changeViewMode(this.value)">
              <span id="view-mode-default">Обычный вид</span>
            </label>
            <label>
              <input type="radio" name="viewMode" value="wiki" onchange="changeViewMode(this.value)">
              <span id="view-mode-wiki">Как на Вики</span>
            </label>
            
            <h3 id="window-size-title">Размер окна статьи</h3>
            <div>
              <button onclick="changeWindowSize('small')" class="theme-option" id="size-small">Маленький</button>
              <button onclick="changeWindowSize('medium')" class="theme-option active" id="size-medium">Средний</button>
              <button onclick="changeWindowSize('large')" class="theme-option" id="size-large">Большой</button>
              <button onclick="changeWindowSize('full')" class="theme-option" id="size-full">На весь экран</button>
            </div>
            
            <h3 id="theme-title">Тема оформления</h3>
            <div>
              <button onclick="changeTheme('light')" class="theme-option active" id="theme-light">Светлая</button>
              <button onclick="changeTheme('dark')" class="theme-option" id="theme-dark">Тёмная</button>
              <button onclick="changeTheme('nature')" class="theme-option" id="theme-nature">Природа</button>
              <button onclick="changeTheme('ocean')" class="theme-option" id="theme-ocean">Океан</button>
            </div>
            
            <h3 id="search-language-title">Язык поиска</h3>
            <select id="search-language-select" class="w-full p-2 border rounded" style="background-color: var(--input-bg); color: var(--text-color);">
              <option value="ru">Русский</option>
              <option value="en">English</option>
              <option value="uk">Українська</option>
              <option value="ja">日本語</option>
              <option value="de">Deutsch</option>
              <option value="fr">Français</option>
              <option value="es">Español</option>
              <option value="zh">中文</option>
            </select>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- Hero Section -->
  <section class="hero">
    <h2 id="welcome-title">Добро пожаловать в WikiSearch!</h2>
    <p id="welcome-text">Ищите и читайте статьи из Википедии прямо здесь.</p>
    <div class="search-example" id="search-example">например: Москва, Эйнштейн, Природа</div>
  </section>

  <!-- Main -->
  <main class="container mx-auto px-4 py-8 fade-in">
    <section id="results-section">
      <h2 id="results-title" class="text-xl font-semibold mb-4">Результаты поиска:</h2>
      <div id="results" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        <!-- Результаты будут добавлены сюда динамически -->
      </div>
    </section>
  </main>

  <!-- Modal окно для просмотра статьи -->
  <div id="article-modal" class="modal">
    <div class="modal-content">
      <span class="close-btn" onclick="closeModal()">&times;</span>
      <button class="back-btn hidden" onclick="goBack()" id="back-btn">← Назад</button>
      <h2 id="modal-title" class="text-2xl font-bold mb-2"></h2>
      <img id="modal-image" class="thumbnail" src="" alt="Изображение статьи" />
      <div id="modal-extract" class="mt-2"></div>
      <iframe id="wiki-iframe" class="wiki-frame hidden medium"></iframe>
      <button id="download-pdf-btn" class="download-btn mt-4 hidden" onclick="downloadPDF()">
        <span id="download-pdf-text">Скачать PDF</span>
      </button>
    </div>
  </div>

  <!-- JavaScript -->
  <script>
    // Локализация
    const translations = {
      ru: {
        welcomeTitle: "Добро пожаловать в WikiSearch!",
        welcomeText: "Ищите и читайте статьи из Википедии прямо здесь.",
        searchExample: "например: Москва, Эйнштейн, Природа",
        searchPlaceholder: "Поиск статей...",
        resultsTitle: "Результаты поиска:",
        noResults: "Ничего не найдено.",
        loadError: "Не удалось загрузить результаты.",
        articleError: "Не удалось загрузить статью.",
        noText: "Нет доступного текста.",
        backButton: "← Назад",
        downloadPdf: "Скачать PDF",
        settingsTitle: "Настройки",
        viewModeTitle: "Режим просмотра",
        viewModeDefault: "Обычный вид",
        viewModeWiki: "Как на Вики",
        windowSizeTitle: "Размер окна статьи",
        sizeSmall: "Маленький",
        sizeMedium: "Средний",
        sizeLarge: "Большой",
        sizeFull: "На весь экран",
        themeTitle: "Тема оформления",
        themeLight: "Светлая",
        themeDark: "Тёмная",
        themeNature: "Природа",
        themeOcean: "Океан",
        searchLanguageTitle: "Язык поиска"
      },
      en: {
        welcomeTitle: "Welcome to WikiSearch!",
        welcomeText: "Search and read Wikipedia articles right here.",
        searchExample: "e.g.: Moscow, Einstein, Nature",
        searchPlaceholder: "Search articles...",
        resultsTitle: "Search results:",
        noResults: "No results found.",
        loadError: "Failed to load results.",
        articleError: "Failed to load article.",
        noText: "No available text.",
        backButton: "← Back",
        downloadPdf: "Download PDF",
        settingsTitle: "Settings",
        viewModeTitle: "View mode",
        viewModeDefault: "Default view",
        viewModeWiki: "Like on Wiki",
        windowSizeTitle: "Article window size",
        sizeSmall: "Small",
        sizeMedium: "Medium",
        sizeLarge: "Large",
        sizeFull: "Full screen",
        themeTitle: "Theme",
        themeLight: "Light",
        themeDark: "Dark",
        themeNature: "Nature",
        themeOcean: "Ocean",
        searchLanguageTitle: "Search language"
      },
      uk: {
        welcomeTitle: "Ласкаво просимо до WikiSearch!",
        welcomeText: "Шукайте та читайте статті з Вікіпедії прямо тут.",
        searchExample: "наприклад: Київ, Ейнштейн, Природа",
        searchPlaceholder: "Пошук статей...",
        resultsTitle: "Результати пошуку:",
        noResults: "Нічого не знайдено.",
        loadError: "Не вдалося завантажити результати.",
        articleError: "Не вдалося завантажити статтю.",
        noText: "Немає доступного тексту.",
        backButton: "← Назад",
        downloadPdf: "Завантажити PDF",
        settingsTitle: "Налаштування",
        viewModeTitle: "Режим перегляду",
        viewModeDefault: "Звичайний вигляд",
        viewModeWiki: "Як у Вікі",
        windowSizeTitle: "Розмір вікна статті",
        sizeSmall: "Маленький",
        sizeMedium: "Середній",
        sizeLarge: "Великий",
        sizeFull: "На весь екран",
        themeTitle: "Тема оформлення",
        themeLight: "Світла",
        themeDark: "Темна",
        themeNature: "Природа",
        themeOcean: "Океан",
        searchLanguageTitle: "Мова пошуку"
      },
      ja: {
        welcomeTitle: "WikiSearchへようこそ！",
        welcomeText: "ウィキペディアの記事をここで直接検索して読むことができます。",
        searchExample: "例：モスクワ、アインシュタイン、自然",
        searchPlaceholder: "記事を検索...",
        resultsTitle: "検索結果:",
        noResults: "結果が見つかりませんでした。",
        loadError: "結果の読み込みに失敗しました。",
        articleError: "記事の読み込みに失敗しました。",
        noText: "利用可能なテキストがありません。",
        backButton: "← 戻る",
        downloadPdf: "PDFをダウンロード",
        settingsTitle: "設定",
        viewModeTitle: "表示モード",
        viewModeDefault: "デフォルト表示",
        viewModeWiki: "Wikiのように",
        windowSizeTitle: "記事ウィンドウのサイズ",
        sizeSmall: "小",
        sizeMedium: "中",
        sizeLarge: "大",
        sizeFull: "全画面",
        themeTitle: "テーマ",
        themeLight: "ライト",
        themeDark: "ダーク",
        themeNature: "自然",
        themeOcean: "海",
        searchLanguageTitle: "検索言語"
      },
      de: {
        welcomeTitle: "Willkommen bei WikiSearch!",
        welcomeText: "Suchen und lesen Sie Wikipedia-Artikel direkt hier.",
        searchExample: "z.B.: Moskau, Einstein, Natur",
        searchPlaceholder: "Artikel suchen...",
        resultsTitle: "Suchergebnisse:",
        noResults: "Keine Ergebnisse gefunden.",
        loadError: "Ergebnisse konnten nicht geladen werden.",
        articleError: "Artikel konnte nicht geladen werden.",
        noText: "Kein verfügbarer Text.",
        backButton: "← Zurück",
        downloadPdf: "PDF herunterladen",
        settingsTitle: "Einstellungen",
        viewModeTitle: "Anzeigemodus",
        viewModeDefault: "Standardansicht",
        viewModeWiki: "Wie auf Wiki",
        windowSizeTitle: "Artikel-Fenstergröße",
        sizeSmall: "Klein",
        sizeMedium: "Mittel",
        sizeLarge: "Groß",
        sizeFull: "Vollbild",
        themeTitle: "Design",
        themeLight: "Hell",
        themeDark: "Dunkel",
        themeNature: "Natur",
        themeOcean: "Ozean",
        searchLanguageTitle: "Suchsprache"
      },
      fr: {
        welcomeTitle: "Bienvenue sur WikiSearch!",
        welcomeText: "Recherchez et lisez des articles de Wikipédia directement ici.",
        searchExample: "ex.: Moscou, Einstein, Nature",
        searchPlaceholder: "Rechercher des articles...",
        resultsTitle: "Résultats de recherche:",
        noResults: "Aucun résultat trouvé.",
        loadError: "Échec du chargement des résultats.",
        articleError: "Échec du chargement de l'article.",
        noText: "Pas de texte disponible.",
        backButton: "← Retour",
        downloadPdf: "Télécharger PDF",
        settingsTitle: "Paramètres",
        viewModeTitle: "Mode d'affichage",
        viewModeDefault: "Vue par défaut",
        viewModeWiki: "Comme sur Wiki",
        windowSizeTitle: "Taille de la fenêtre d'article",
        sizeSmall: "Petit",
        sizeMedium: "Moyen",
        sizeLarge: "Grand",
        sizeFull: "Plein écran",
        themeTitle: "Thème",
        themeLight: "Clair",
        themeDark: "Sombre",
        themeNature: "Nature",
        themeOcean: "Océan",
        searchLanguageTitle: "Langue de recherche"
      },
      es: {
        welcomeTitle: "¡Bienvenido a WikiSearch!",
        welcomeText: "Busca y lee artículos de Wikipedia directamente aquí.",
        searchExample: "ej.: Moscú, Einstein, Naturaleza",
        searchPlaceholder: "Buscar artículos...",
        resultsTitle: "Resultados de búsqueda:",
        noResults: "No se encontraron resultados.",
        loadError: "Error al cargar los resultados.",
        articleError: "Error al cargar el artículo.",
        noText: "No hay texto disponible.",
        backButton: "← Atrás",
        downloadPdf: "Descargar PDF",
        settingsTitle: "Configuración",
        viewModeTitle: "Modo de visualización",
        viewModeDefault: "Vista predeterminada",
        viewModeWiki: "Como en Wiki",
        windowSizeTitle: "Tamaño de la ventana del artículo",
        sizeSmall: "Pequeño",
        sizeMedium: "Mediano",
        sizeLarge: "Grande",
        sizeFull: "Pantalla completa",
        themeTitle: "Tema",
        themeLight: "Claro",
        themeDark: "Oscuro",
        themeNature: "Naturaleza",
        themeOcean: "Océano",
        searchLanguageTitle: "Idioma de búsqueda"
      },
      zh: {
        welcomeTitle: "欢迎使用WikiSearch!",
        welcomeText: "在这里直接搜索和阅读维基百科文章。",
        searchExample: "例如：莫斯科，爱因斯坦，自然",
        searchPlaceholder: "搜索文章...",
        resultsTitle: "搜索结果:",
        noResults: "未找到结果。",
        loadError: "加载结果失败。",
        articleError: "加载文章失败。",
        noText: "没有可用文本。",
        backButton: "← 返回",
        downloadPdf: "下载PDF",
        settingsTitle: "设置",
        viewModeTitle: "查看模式",
        viewModeDefault: "默认视图",
        viewModeWiki: "维基样式",
        windowSizeTitle: "文章窗口大小",
        sizeSmall: "小",
        sizeMedium: "中",
        sizeLarge: "大",
        sizeFull: "全屏",
        themeTitle: "主题",
        themeLight: "浅色",
        themeDark: "深色",
        themeNature: "自然",
        themeOcean: "海洋",
        searchLanguageTitle: "搜索语言"
      }
    };

    // Элементы DOM
    const searchForm = document.getElementById('search-form');
    const searchInput = document.getElementById('search-input');
    const resultsContainer = document.getElementById('results');
    const modal = document.getElementById('article-modal');
    const modalTitle = document.getElementById('modal-title');
    const modalImage = document.getElementById('modal-image');
    const modalExtract = document.getElementById('modal-extract');
    const wikiIframe = document.getElementById('wiki-iframe');
    const backBtn = document.getElementById('back-btn');
    const downloadPdfBtn = document.getElementById('download-pdf-btn');
    const searchLanguageSelect = document.getElementById('search-language-select');

    // Состояние приложения
    let currentViewMode = 'default';
    let currentArticleUrl = '';
    let historyStack = [];
    let historyIndex = -1;
    let currentLanguage = 'ru';
    let searchLanguage = 'ru';
    let currentTheme = 'light';
    let currentWindowSize = 'medium';

    // Инициализация при загрузке страницы
    document.addEventListener('DOMContentLoaded', () => {
      // Проверяем сохранённые настройки в localStorage
      const savedLanguage = localStorage.getItem('wikiSearchLanguage');
      const savedSearchLanguage = localStorage.getItem('wikiSearchSearchLanguage');
      const savedViewMode = localStorage.getItem('wikiSearchViewMode');
      const savedTheme = localStorage.getItem('wikiSearchTheme');
      const savedWindowSize = localStorage.getItem('wikiSearchWindowSize');
      
      if (savedLanguage) {
        currentLanguage = savedLanguage;
      }
      
      if (savedSearchLanguage) {
        searchLanguage = savedSearchLanguage;
        searchLanguageSelect.value = searchLanguage;
      }
      
      if (savedViewMode) {
        currentViewMode = savedViewMode;
        document.querySelector(`input[name="viewMode"][value="${currentViewMode}"]`).checked = true;
      }
      
      if (savedTheme) {
        currentTheme = savedTheme;
        document.body.classList.add(currentTheme);
        document.getElementById(`theme-${currentTheme}`).classList.add('active');
        // Удаляем active у других кнопок тем
        document.querySelectorAll('.theme-option').forEach(btn => {
          if (btn.id !== `theme-${currentTheme}`) {
            btn.classList.remove('active');
          }
        });
      }
      
      if (savedWindowSize) {
        currentWindowSize = savedWindowSize;
        if (wikiIframe) {
          wikiIframe.className = `wiki-frame hidden ${currentWindowSize}`;
        }
        document.getElementById(`size-${currentWindowSize}`).classList.add('active');
        // Удаляем active у других кнопок размеров
        document.querySelectorAll('.theme-option').forEach(btn => {
          if (btn.id !== `size-${currentWindowSize}` && btn.id.startsWith('size-')) {
            btn.classList.remove('active');
          }
        });
      }
      
      updateLanguageUI();
    });

    // Функции для работы с языками
    function toggleLanguageDropdown() {
      document.getElementById('language-dropdown').classList.toggle('show');
    }

    function changeLanguage(lang, langName) {
      currentLanguage = lang;
      localStorage.setItem('wikiSearchLanguage', lang);
      updateLanguageUI();
      toggleLanguageDropdown();
      
      // Обновляем placeholder в поиске
      searchInput.placeholder = translations[lang].searchPlaceholder;
      
      // Если был выполнен поиск, обновляем результаты
      if (searchInput.value.trim().length > 0) {
        searchArticles(searchInput.value.trim());
      }
    }

    function updateLanguageUI() {
      // Обновляем флаг
      const flagUrl = `https://flagcdn.com/${currentLanguage === 'zh' ? 'cn' : currentLanguage === 'en' ? 'gb' : currentLanguage}.svg`;
      document.getElementById('current-language-flag').src = flagUrl;
      document.getElementById('current-language-flag').onerror = function() {
        this.src = 'https://flagcdn.com/ru.svg';
      };
      
      // Обновляем все текстовые элементы
      const lang = translations[currentLanguage];
      
      document.getElementById('welcome-title').textContent = lang.welcomeTitle;
      document.getElementById('welcome-text').textContent = lang.welcomeText;
      document.getElementById('search-example').textContent = lang.searchExample;
      document.getElementById('results-title').textContent = lang.resultsTitle;
      document.getElementById('back-btn').textContent = lang.backButton;
      document.getElementById('download-pdf-text').textContent = lang.downloadPdf;
      document.getElementById('settings-title').textContent = lang.settingsTitle;
      document.getElementById('view-mode-title').textContent = lang.viewModeTitle;
      document.getElementById('view-mode-default').textContent = lang.viewModeDefault;
      document.getElementById('view-mode-wiki').textContent = lang.viewModeWiki;
      document.getElementById('window-size-title').textContent = lang.windowSizeTitle;
      document.getElementById('size-small').textContent = lang.sizeSmall;
      document.getElementById('size-medium').textContent = lang.sizeMedium;
      document.getElementById('size-large').textContent = lang.sizeLarge;
      document.getElementById('size-full').textContent = lang.sizeFull;
      document.getElementById('theme-title').textContent = lang.themeTitle;
      document.getElementById('theme-light').textContent = lang.themeLight;
      document.getElementById('theme-dark').textContent = lang.themeDark;
      document.getElementById('theme-nature').textContent = lang.themeNature;
      document.getElementById('theme-ocean').textContent = lang.themeOcean;
      document.getElementById('search-language-title').textContent = lang.searchLanguageTitle;
      
      // Обновляем placeholder в поиске
      searchInput.placeholder = lang.searchPlaceholder;
    }

    // Закрываем выпадающий список языков при клике вне его
    window.addEventListener('click', (e) => {
      if (!e.target.matches('.language-btn') && !e.target.closest('.language-dropdown')) {
        const dropdown = document.getElementById('language-dropdown');
        if (dropdown.classList.contains('show')) {
          dropdown.classList.remove('show');
        }
      }
      
      // Закрываем панель настроек при клике вне ее
      if (!e.target.closest('.settings-icon') && !e.target.closest('#settings-panel')) {
        document.getElementById('settings-panel').style.display = 'none';
      }
    });

    // Обработчик изменения языка поиска
    searchLanguageSelect.addEventListener('change', (e) => {
      searchLanguage = e.target.value;
      localStorage.setItem('wikiSearchSearchLanguage', searchLanguage);
      
      // Если был выполнен поиск, обновляем результаты
      if (searchInput.value.trim().length > 0) {
        searchArticles(searchInput.value.trim());
      }
    });

    function toggleSettings() {
      const panel = document.getElementById('settings-panel');
      panel.style.display = panel.style.display === 'block' ? 'none' : 'block';
    }

    function changeViewMode(mode) {
      currentViewMode = mode;
      localStorage.setItem('wikiSearchViewMode', mode);

      if (mode === 'wiki') {
        modalExtract.classList.add('hidden');
        wikiIframe.classList.remove('hidden');
        wikiIframe.className = `wiki-frame ${currentWindowSize}`;
        modalImage.classList.add('hidden');
        downloadPdfBtn.classList.add('hidden');
        if (currentArticleUrl) {
          wikiIframe.src = currentArticleUrl;
        }
      } else {
        wikiIframe.classList.add('hidden');
        modalExtract.classList.remove('hidden');
        modalImage.classList.remove('hidden');
        downloadPdfBtn.classList.remove('hidden');
      }
    }

    function changeWindowSize(size) {
      currentWindowSize = size;
      localStorage.setItem('wikiSearchWindowSize', size);
      
      // Обновляем класс iframe
      if (wikiIframe && !wikiIframe.classList.contains('hidden')) {
        wikiIframe.className = `wiki-frame ${size}`;
      }
      
      // Обновляем активную кнопку
      document.querySelectorAll('[id^="size-"]').forEach(btn => {
        btn.classList.remove('active');
      });
      document.getElementById(`size-${size}`).classList.add('active');
    }

    function changeTheme(theme) {
      // Удаляем предыдущую тему
      document.body.classList.remove('light', 'dark', 'nature', 'ocean');
      
      // Добавляем новую тему
      document.body.classList.add(theme);
      currentTheme = theme;
      localStorage.setItem('wikiSearchTheme', theme);
      
      // Обновляем активную кнопку
      document.querySelectorAll('[id^="theme-"]').forEach(btn => {
        btn.classList.remove('active');
      });
      document.getElementById(`theme-${theme}`).classList.add('active');
    }

    function openArticle(title) {
      const encodedTitle = encodeURIComponent(title).replace(/ /g, '_');
      const url = `https://${searchLanguage}.wikipedia.org/wiki/${encodedTitle}`;
      currentArticleUrl = url;

      // Обновление истории
      if (historyIndex < historyStack.length - 1) {
        historyStack = historyStack.slice(0, historyIndex + 1);
      }

      historyStack.push({ title, url });
      historyIndex++;

      updateNavigationButtons();

      if (currentViewMode === 'wiki') {
        modalTitle.textContent = title;
        modalExtract.classList.add('hidden');
        wikiIframe.classList.remove('hidden');
        wikiIframe.className = `wiki-frame ${currentWindowSize}`;
        modalImage.classList.add('hidden');
        downloadPdfBtn.classList.add('hidden');
        wikiIframe.src = url;
      } else {
        loadDefaultView(title, encodedTitle);
      }

      modal.classList.add('active');
      document.body.style.overflow = 'hidden';
    }

    async function loadDefaultView(title, encodedTitle) {
      try {
        const apiUrl = `https://${searchLanguage}.wikipedia.org/w/api.php?action=query&prop=extracts|pageimages&pithumbsize=400&titles=${encodedTitle}&exintro=1&explaintext=1&format=json&origin=*`;
        const response = await fetch(apiUrl);
        const data = await response.json();
        const pageId = Object.keys(data.query.pages)[0];
        const page = data.query.pages[pageId];

        modalTitle.textContent = page.title || title;
        modalExtract.innerHTML = `<p>${page.extract || translations[currentLanguage].noText}</p>`;
        modalExtract.classList.remove('hidden');
        wikiIframe.classList.add('hidden');
        downloadPdfBtn.classList.remove('hidden');

        if (page.thumbnail && page.thumbnail.source) {
          modalImage.src = page.thumbnail.source;
          modalImage.classList.remove('hidden');
        } else {
          modalImage.classList.add('hidden');
        }
      } catch (error) {
        console.error("Ошибка загрузки статьи:", error);
        modalExtract.innerHTML = `<p>${translations[currentLanguage].articleError}</p>`;
      }
    }

    function goBack() {
      if (historyIndex > 0) {
        historyIndex--;
        const article = historyStack[historyIndex];
        const encodedTitle = encodeURIComponent(article.title).replace(/ /g, '_');

        currentArticleUrl = article.url;

        if (currentViewMode === 'wiki') {
          modalTitle.textContent = article.title;
          wikiIframe.src = article.url;
        } else {
          loadDefaultView(article.title, encodedTitle);
        }

        updateNavigationButtons();
      }
    }

    function updateNavigationButtons() {
      backBtn.classList.toggle('hidden', historyIndex <= 0);
    }

    function closeModal() {
      modal.classList.remove('active');
      document.body.style.overflow = 'auto';
    }

    // Поиск статей
    async function searchArticles(query) {
      const url = `https://${searchLanguage}.wikipedia.org/w/api.php?action=query&list=search&srsearch=${encodeURIComponent(query)}&format=json&origin=*`;

      try {
        const response = await fetch(url);
        const data = await response.json();
        const results = data.query.search;

        displayResults(results);
      } catch (error) {
        console.error("Ошибка при поиске:", error);
        resultsContainer.innerHTML = `<p class="text-red-500">${translations[currentLanguage].loadError}</p>`;
      }
    }

    // Отображение результатов
    function displayResults(results) {
      resultsContainer.innerHTML = '';

      if (results.length === 0) {
        resultsContainer.innerHTML = `<p class="text-gray-500">${translations[currentLanguage].noResults}</p>`;
        return;
      }

      results.forEach(result => {
        const title = result.title;
        const snippet = result.snippet.replace(/<\/?span[^>]*>/g, '');

        const card = document.createElement('div');
        card.className = "card";
        card.innerHTML = `
          <img src="https://${searchLanguage}.wikipedia.org/wiki/Special:Random/File" class="thumbnail" onError="this.style.display='none'" />
          <div class="card-body">
            <h3 class="card-title">${title}</h3>
            <p class="card-excerpt">${snippet}...</p>
          </div>
        `;
        card.addEventListener('click', () => openArticle(title));
        resultsContainer.appendChild(card);
      });
    }

    // Скачивание PDF через html2pdf.js
    function downloadPDF() {
      const element = document.createElement('div');
      element.style.padding = '20px';
      element.style.maxWidth = '800px';
      
      // Копируем контент статьи
      const title = modalTitle.textContent;
      const imageSrc = modalImage.src;
      const extract = modalExtract.innerHTML;
      
      element.innerHTML = `
        <h1 style="font-size: 24px; margin-bottom: 10px; color: #1a202c;">${title}</h1>
        ${imageSrc ? `<img src="${imageSrc}" style="max-width: 100%; margin-bottom: 15px; border-radius: 4px;">` : ''}
        <div style="font-size: 16px; line-height: 1.6; color: #4a5568;">${extract}</div>
        <p style="margin-top: 20px; font-size: 12px; color: #718096;">
          ${translations[currentLanguage].downloadPdf}: Wikipedia (${new Date().toLocaleDateString()})
        </p>
      `;

      const opt = {
        margin: 10,
        filename: `${title}.pdf`,
        image: { type: 'jpeg', quality: 0.98 },
        html2canvas: { 
          scale: 2,
          logging: true,
          useCORS: true,
          allowTaint: true
        },
        jsPDF: { 
          unit: 'mm',
          format: 'a4',
          orientation: 'portrait' 
        }
      };

      // Показываем уведомление о начале генерации PDF
      const loadingText = translations[currentLanguage].downloadPdf + '...';
      downloadPdfBtn.disabled = true;
      downloadPdfBtn.innerHTML = `<span>${loadingText}</span>`;
      
      // Генерация PDF
      const worker = html2pdf()
        .set(opt)
        .from(element)
        .save()
        .then(() => {
          downloadPdfBtn.disabled = false;
          downloadPdfBtn.innerHTML = `<span>${translations[currentLanguage].downloadPdf}</span>`;
        })
        .catch(err => {
          console.error('Ошибка генерации PDF:', err);
          downloadPdfBtn.disabled = false;
          downloadPdfBtn.innerHTML = `<span>${translations[currentLanguage].downloadPdf}</span>`;
          
          // Попробуем альтернативный метод для Telegram
          if (navigator.userAgent.includes('Telegram')) {
            const blob = new Blob([element.innerHTML], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${title}.html`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
          } else {
            alert(translations[currentLanguage].articleError);
          }
        });
    }

    // Обработка формы поиска
    searchForm.addEventListener('submit', (e) => {
      e.preventDefault();
      const query = searchInput.value.trim();
      if (query) {
        searchArticles(query);
      }
    });

    // Автопоиск при вводе
    let searchTimeout;
    searchInput.addEventListener('input', () => {
      clearTimeout(searchTimeout);
      const query = searchInput.value.trim();
      if (query.length > 2) {
        searchTimeout = setTimeout(() => {
          searchArticles(query);
        }, 500);
      } else if (query.length === 0) {
        resultsContainer.innerHTML = '';
      }
    });

    // Закрытие модального окна по клику вне контента
    modal.addEventListener('click', (e) => {
      if (e.target === modal) {
        closeModal();
      }
    });
  </script>
</body>
          </html>
