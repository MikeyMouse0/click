<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>WikiSearch — Поиск статей</title>
  <script src="https://cdn.tailwindcss.com "></script>
  <!-- Библиотека для генерации PDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js "></script>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    .fade-in {
      animation: fadeIn 0.4s ease-in-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* Модальное окно */
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0,0,0,0.6);
      display: none;
      justify-content: center;
      align-items: flex-start;
      z-index: 50;
      padding: 20px;
    }

    .modal.active {
      display: flex;
    }

    .modal-content {
      background: white;
      padding: 20px;
      border-radius: 12px;
      max-height: 90vh;
      overflow-y: auto;
      width: 100%;
      max-width: 900px;
      position: relative;
    }

    .close-btn {
      position: absolute;
      top: 10px;
      right: 10px;
      cursor: pointer;
      font-size: 1.5rem;
      color: #777;
    }

    .back-btn, .download-btn {
      margin-bottom: 10px;
      font-weight: bold;
      cursor: pointer;
      padding: 6px 12px;
      border-radius: 6px;
      transition: all 0.3s ease;
    }

    .back-btn {
      color: #0073e6;
      background: transparent;
      border: none;
      font-size: 1rem;
    }

    .download-btn {
      background-color: #10b981;
      color: white;
      border: none;
      font-weight: bold;
    }

    .download-btn:hover {
      background-color: #059669;
    }

    .settings-icon {
      cursor: pointer;
      transition: transform 0.3s;
    }

    .settings-icon:hover {
      transform: rotate(90deg);
    }

    /* Панель настроек */
    .settings-panel {
      position: fixed;
      top: 70px;
      right: 20px;
      background: white;
      border: 1px solid #ccc;
      border-radius: 8px;
      padding: 15px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      z-index: 60;
      display: none;
      min-width: 200px;
    }

    .settings-panel label {
      display: block;
      margin-bottom: 10px;
    }

    /* iframe для отображения "как на Вики" */
    .wiki-frame {
      width: 100%;
      height: 600px;
      border: none;
      margin-top: 10px;
      border-radius: 8px;
    }

    /* Карточка статьи */
    .card {
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      transition: box-shadow 0.3s;
      overflow: hidden;
      cursor: pointer;
    }

    .card:hover {
      box-shadow: 0 4px 10px rgba(0,0,0,0.15);
    }

    .thumbnail {
      width: 100%;
      height: auto;
      object-fit: cover;
      max-height: 200px;
    }

    .card-body {
      padding: 15px;
    }

    .card-title {
      font-weight: bold;
      font-size: 1.1rem;
      color: #0073e6;
      margin-bottom: 10px;
    }

    .card-excerpt {
      font-size: 0.9rem;
      color: #444;
    }

    /* Приветствие */
    .hero {
      text-align: center;
      padding: 20px 0;
      animation: fadeIn 1s ease-in-out;
    }

    .hero h2 {
      font-size: 2rem;
      font-weight: bold;
      color: #1a202c;
    }

    .hero p {
      font-size: 1.1rem;
      color: #4a5568;
      margin: 10px 0 20px;
    }

    .search-example {
      display: inline-block;
      padding: 4px 12px;
      background: #e2e8f0;
      border-radius: 6px;
      font-style: italic;
      animation: blink 2s infinite;
    }

    @keyframes blink {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.4; }
    }
  </style>
</head>
<body class="bg-gray-100 text-gray-900">

  <!-- Header -->
  <header class="bg-white shadow-md sticky top-0 z-10">
    <div class="container mx-auto px-4 py-4 flex justify-between items-center">
      <h1 class="text-2xl font-bold text-blue-600">WikiSearch</h1>

      <form id="search-form" class="relative w-full max-w-lg mx-4">
        <input 
          type="text" 
          id="search-input" 
          placeholder="Поиск статей..." 
          class="w-full p-3 pl-10 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
        />
        <svg class="absolute left-3 top-3.5 w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
        </svg>
      </form>

      <!-- Кнопка настроек -->
      <div class="relative">
        <svg onclick="toggleSettings()" class="settings-icon w-6 h-6 text-gray-600 cursor-pointer" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
        </svg>

        <!-- Панель настроек -->
        <div id="settings-panel" class="settings-panel">
          <label>
            <input type="radio" name="viewMode" value="default" checked onchange="changeViewMode(this.value)"> Обычный вид
          </label>
          <label>
            <input type="radio" name="viewMode" value="wiki" onchange="changeViewMode(this.value)"> Как на Вики
          </label>
        </div>
      </div>
    </div>
  </header>

  <!-- Hero Section -->
  <section class="hero">
    <h2>Добро пожаловать в WikiSearch!</h2>
    <p>Ищите и читайте статьи из русской Википедии прямо здесь.</p>
    <div class="search-example">например: Москва, Эйнштейн, Природа</div>
  </section>

  <!-- Main -->
  <main class="container mx-auto px-4 py-8 fade-in">
    <section id="results-section">
      <h2 class="text-xl font-semibold mb-4">Результаты поиска:</h2>
      <div id="results" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        <!-- Результаты будут добавлены сюда динамически -->
      </div>
    </section>
  </main>

  <!-- Modal окно для просмотра статьи -->
  <div id="article-modal" class="modal">
    <div class="modal-content">
      <span class="close-btn" onclick="closeModal()">&times;</span>
      <button class="back-btn hidden" onclick="goBack()">← Назад</button>
      <h2 id="modal-title" class="text-2xl font-bold mb-2"></h2>
      <img id="modal-image" class="thumbnail" src="" alt="Изображение статьи" />
      <div id="modal-extract" class="mt-2 text-gray-700"></div>
      <iframe id="wiki-iframe" class="wiki-frame hidden"></iframe>
      <button id="download-pdf-btn" class="download-btn mt-4 hidden">Скачать PDF</button>
    </div>
  </div>

  <!-- JavaScript -->
  <script>
    const searchForm = document.getElementById('search-form');
    const searchInput = document.getElementById('search-input');
    const resultsContainer = document.getElementById('results');
    const modal = document.getElementById('article-modal');
    const modalTitle = document.getElementById('modal-title');
    const modalImage = document.getElementById('modal-image');
    const modalExtract = document.getElementById('modal-extract');
    const wikiIframe = document.getElementById('wiki-iframe');
    const backBtn = document.querySelector('.back-btn');
    const downloadPdfBtn = document.getElementById('download-pdf-btn');

    let currentViewMode = 'default';
    let currentArticleUrl = '';
    let historyStack = [];
    let historyIndex = -1;

    function toggleSettings() {
      const panel = document.getElementById('settings-panel');
      panel.style.display = panel.style.display === 'block' ? 'none' : 'block';
    }

    function changeViewMode(mode) {
      currentViewMode = mode;

      if (mode === 'wiki') {
        modalExtract.classList.add('hidden');
        wikiIframe.classList.remove('hidden');
        modalImage.classList.add('hidden');
        downloadPdfBtn.classList.add('hidden'); // Нельзя скачать iframe
        wikiIframe.src = currentArticleUrl;
      } else {
        wikiIframe.classList.add('hidden');
        modalExtract.classList.remove('hidden');
        modalImage.classList.remove('hidden');
        downloadPdfBtn.classList.remove('hidden');
      }
    }

    function openArticle(title) {
      const encodedTitle = encodeURIComponent(title).replace(/ /g, '_');
      const url = `https://ru.wikipedia.org/wiki/ ${encodedTitle}`;
      currentArticleUrl = url;

      // Обновление истории
      if (historyIndex < historyStack.length - 1) {
        historyStack = historyStack.slice(0, historyIndex + 1);
      }

      historyStack.push({ title, url });
      historyIndex++;

      updateNavigationButtons();

      if (currentViewMode === 'wiki') {
        modalTitle.textContent = title;
        modalExtract.classList.add('hidden');
        wikiIframe.classList.remove('hidden');
        modalImage.classList.add('hidden');
        wikiIframe.src = url;
      } else {
        loadDefaultView(title, encodedTitle);
      }

      modal.classList.add('active');
    }

    async function loadDefaultView(title, encodedTitle) {
      try {
        const apiUrl = `https://ru.wikipedia.org/w/api.php?action=query&prop=extracts|pageimages&pithumbsize=400&titles=${encodedTitle}&exintro=1&explaintext=1&format=json&origin=*`;
        const response = await fetch(apiUrl);
        const data = await response.json();
        const pageId = Object.keys(data.query.pages)[0];
        const page = data.query.pages[pageId];

        modalTitle.textContent = page.title;
        modalExtract.innerHTML = `<p>${page.extract || 'Нет доступного текста.'}</p>`;
        modalExtract.classList.remove('hidden');
        wikiIframe.classList.add('hidden');

        if (page.thumbnail && page.thumbnail.source) {
          modalImage.src = page.thumbnail.source;
          modalImage.classList.remove('hidden');
        } else {
          modalImage.classList.add('hidden');
        }
      } catch (error) {
        console.error("Ошибка загрузки статьи:", error);
        modalExtract.innerHTML = '<p>Не удалось загрузить статью.</p>';
      }
    }

    function goBack() {
      if (historyIndex > 0) {
        historyIndex--;
        const article = historyStack[historyIndex];
        const encodedTitle = encodeURIComponent(article.title).replace(/ /g, '_');

        currentArticleUrl = article.url;

        if (currentViewMode === 'wiki') {
          modalTitle.textContent = article.title;
          wikiIframe.src = article.url;
        } else {
          loadDefaultView(article.title, encodedTitle);
        }

        updateNavigationButtons();
      }
    }

    function updateNavigationButtons() {
      backBtn.classList.toggle('hidden', historyIndex <= 0);
    }

    function closeModal() {
      modal.classList.remove('active');
    }

    // Поиск статей
    async function searchArticles(query) {
      const url = ` https://ru.wikipedia.org/w/api.php?action=query&list=search&srsearch=${encodeURIComponent(query)}&format=json&origin=*`;

      try {
        const response = await fetch(url);
        const data = await response.json();
        const results = data.query.search;

        displayResults(results);
      } catch (error) {
        console.error("Ошибка при поиске:", error);
        resultsContainer.innerHTML = "<p>Не удалось загрузить результаты.</p>";
      }
    }

    // Отображение результатов
    function displayResults(results) {
      resultsContainer.innerHTML = '';

      if (results.length === 0) {
        resultsContainer.innerHTML = "<p>Ничего не найдено.</p>";
        return;
      }

      results.forEach(result => {
        const title = result.title;
        const snippet = result.snippet.replace(/<\/?span[^>]*>/g, '');

        const card = document.createElement('div');
        card.className = "card";
        card.innerHTML = `
          <img src=" https://ru.wikipedia.org/wiki/Special :Random/File" class="thumbnail" onError="this.style.display='none'" />
          <div class="card-body">
            <h3 class="card-title">${title}</h3>
            <p class="card-excerpt">${snippet}...</p>
          </div>
        `;
        card.addEventListener('click', () => openArticle(title));
        resultsContainer.appendChild(card);
      });
    }

    // Скачивание PDF
    function downloadPDF() {
      const element = document.createElement('div');
      element.innerHTML = `
        <h1 style="font-size: 24px; margin-bottom: 10px;">${modalTitle.textContent}</h1>
        ${modalImage.src ? `<img src="${modalImage.src}" style="max-width: 100%; margin-bottom: 10px;">` : ''}
        <div>${modalExtract.innerHTML}</div>
      `;

      const opt = {
        margin:       0.5,
        filename:     `${modalTitle.textContent}.pdf`,
        image:        { type: 'jpeg', quality: 0.98 },
        html2canvas:  { scale: 2 },
        jsPDF:        { unit: 'in', format: 'letter', orientation: 'portrait' }
      };

      html2pdf().set(opt).from(element).save();
    }

    // Обработка формы поиска
    searchForm.addEventListener('submit', (e) => {
      e.preventDefault();
      const query = searchInput.value.trim();
      if (query) {
        searchArticles(query);
      }
    });

    // Автопоиск при вводе
    searchInput.addEventListener('input', () => {
      const query = searchInput.value.trim();
      if (query.length > 2) {
        searchArticles(query);
      }
    });

    // Закрытие модального окна по клику вне контента
    modal.addEventListener('click', (e) => {
      if (e.target === modal) {
        closeModal();
      }
    });
  </script>
</body>
    </html>
